<!DOCTYPE html>
<html>
<head>
    <title>mytwitfacetube</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Styles -->
    <style>
        .item {
            width: 250px;
            max-width: 450px;
        }
    </style>
    <!-- Scripts -->
    <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.1.min.js"></script>
    <script src="js/jquery.isotope.min.js"></script>
    <!-- <script src="js/bootstrap.min.js"></script>
	<script src="js/jquery.masonry.min.js"></script> -->
    <script src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-2.1.0.js"></script>
</head>
<body>
    <div id="container" data-bind="foreach: newsItems">
        <div class="item">
            <h4 data-bind="text:title"></h4>
            <img data-bind="attr: { src: thumbnailUrl }">
            <p>
                <span data-bind="text:headline"></span>
                <a data-bind="attr: { href: url, title: title }">More...</a>                
            </p>
            <p data-bind="text: time"></p>
        </div>
    </div>
    <script type="text/javascript">
        // Class to represent a news item
        var newsItem = function (url, title, headline, imageUrl, thumbnailUrl, text, time) {
            var _this = this;

            _this.url = url;
            _this.title = title;
            _this.headline = headline;
            _this.imageUrl = imageUrl;
            _this.thumbnailUrl = thumbnailUrl;
            _this.text = text;
            _this.time = new Date(time);
        }

        var viewModel = new appViewModel();

        // Overall viewmodel for this screen, along with initial state
        function appViewModel() {
            var _this = this;

            // Data
            _this.newsItems = ko.observableArray([]);

            _this.styleAndSort = function () {
                // Sort the news items
                _this.newsItems.sort(function (item1, item2) {
                    return item1.time < item2.time ? 1 : item1.time > item2.time ? -1 : 0;
                });

                // Apply Isotope
                $('#container').isotope({
                    // options
                    itemSelector: '.item',
                    layoutMode: 'masonry'
                });
            };
        };

        $(function () {
            $.getJSON("https://api.twitter.com/1/statuses/user_timeline.json?screen_name=ninjatunehq&include_rts=true&count=20&callback=?", function (data) {
                // Create a new newsItem for every result from twitter
                $.each(data, function (key, value) {
                    viewModel.newsItems.push(new newsItem(value.source, value.text, value.text, value.user.profile_image_url, value.user.profile_image_url, value.text, value.created_at));
                });
                // viewModel.styleAndSort();
            });

            $.getJSON("http://gdata.youtube.com/feeds/api/users/ninja000/uploads?v=2&alt=jsonc", function (data) {
                $.each(data.data.items, function (key, value) {
                    viewModel.newsItems.push(new newsItem(value.player.default, value.title, value.title, value.thumbnail.hqdefault, value.thumbnail.default, value.title, value.updated));
                });
                // viewModel.styleAndSort();
            });

            $.getJSON('https://api.soundcloud.com/users/ninja-tune/tracks.json?client_id=0f09d82872276292dad27414f7d88531', function (data) {
                $.each(data, function (key, value) {
                    viewModel.newsItems.push(new newsItem(value.permalink_url, value.title, value.title, value.artwork_url, value.artwork_url, value.description, value.created_at));
                });
                // viewModel.styleAndSort();
            });

            ko.applyBindings(viewModel);
        });
    </script>
</body>
</html>
